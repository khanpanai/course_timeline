{"version":3,"file":"step.min.js","sources":["../src/step.js"],"sourcesContent":["import * as config from 'core/config';\n\nconst courseCacheKey = \"course_timeline_course_id\";\nconst sectionCacheKey = \"course_timeline_section_id\";\n\nexport const init = async() => {\n\n    const courseSelect = document.querySelector(\"[name='ramctl-course-select']\");\n\n    const cachedId = window.localStorage.getItem(courseCacheKey);\n\n    if (cachedId) {\n        const selectOptions = courseSelect.getElementsByTagName('option');\n        for (const option of selectOptions) {\n            if (option.value === cachedId) {\n                option.selected = true;\n            }\n        }\n    }\n    await loadSections(cachedId ?? courseSelect.value);\n    await initSections(cachedId ?? courseSelect.value);\n    courseSelect.addEventListener('change', async function() {\n        window.localStorage.setItem(courseCacheKey, courseSelect.value);\n        await loadSections(courseSelect.value);\n        await initSections(courseSelect.value);\n    });\n\n};\n\nconst initSections = async(courseId) => {\n    const sectionSelect = document.querySelector(\"[name='ramctl-section-select']\");\n\n    const cachedId = window.localStorage.getItem(sectionCacheKey);\n\n    if (cachedId) {\n        const selectOptions = sectionSelect.getElementsByTagName('option');\n        for (const option of selectOptions) {\n            if (option.value === cachedId) {\n                option.selected = true;\n            }\n        }\n    }\n\n    await loadTimeline(courseId, cachedId ?? sectionSelect.value);\n    await loadEndTime(courseId, cachedId ?? sectionSelect.value);\n    sectionSelect.addEventListener('change', async function() {\n        window.localStorage.setItem(\"course_timeline_section_id\", this.value);\n        await loadTimeline(courseId, this.value);\n        await loadEndTime(courseId, sectionSelect.value);\n    });\n};\n\nconst loadSections = async(id) => {\n    const startNode = window.document.querySelector(\"[data-section-select]\");\n    const requestUrl = new URL(`${config.wwwroot}/blocks/course_timeline/ajax.php?action=get_modules&courseId=${+id}`);\n    const response = await fetch(requestUrl);\n    const responseHtml = await response.text();\n    window.console.log(responseHtml);\n    startNode.textContent = \"\";\n    startNode.insertAdjacentHTML(\"afterbegin\", responseHtml);\n};\n\nconst loadTimeline = async(courseId, id) => {\n    const startNode = window.document.getElementById(\"ramctl-content\");\n\n    const requestUrl =\n        new URL(`${config.wwwroot}/blocks/course_timeline/ajax.php?action=timeline&sectionId=${+id}&courseId=${+courseId}`);\n    const response = await fetch(requestUrl);\n    const responseHtml = await response.text();\n\n    startNode.textContent = \"\";\n    startNode.insertAdjacentHTML(\"afterbegin\", responseHtml);\n\n};\n\nconst loadEndTime = async(courseId, id) => {\n    const startNode = window.document.querySelector(\"span[data-end]\");\n\n    const requestUrl =\n        new URL(`${config.wwwroot}/blocks/course_timeline/ajax.php?action=end&sectionId=${+id}&courseId=${+courseId}`);\n    const response = await fetch(requestUrl);\n    const responseHtml = await response.text();\n\n    startNode.innerHTML = responseHtml;\n};"],"names":["async","courseSelect","document","querySelector","cachedId","window","localStorage","getItem","selectOptions","getElementsByTagName","option","value","selected","loadSections","initSections","addEventListener","setItem","sectionSelect","loadTimeline","courseId","loadEndTime","this","startNode","requestUrl","URL","config","wwwroot","id","response","fetch","responseHtml","text","console","log","textContent","insertAdjacentHTML","getElementById","innerHTML"],"mappings":"mmCAKoBA,gBAEVC,aAAeC,SAASC,cAAc,iCAEtCC,SAAWC,OAAOC,aAAaC,QAPlB,gCASfH,SAAU,OACJI,cAAgBP,aAAaQ,qBAAqB,cACnD,MAAMC,UAAUF,cACbE,OAAOC,QAAUP,WACjBM,OAAOE,UAAW,SAIxBC,aAAaT,UAAYH,aAAaU,aACtCG,aAAaV,UAAYH,aAAaU,OAC5CV,aAAac,iBAAiB,UAAUf,iBACpCK,OAAOC,aAAaU,QApBL,4BAoB6Bf,aAAaU,aACnDE,aAAaZ,aAAaU,aAC1BG,aAAab,aAAaU,iBAKlCG,aAAed,MAAAA,iBACXiB,cAAgBf,SAASC,cAAc,kCAEvCC,SAAWC,OAAOC,aAAaC,QA7BjB,iCA+BhBH,SAAU,OACJI,cAAgBS,cAAcR,qBAAqB,cACpD,MAAMC,UAAUF,cACbE,OAAOC,QAAUP,WACjBM,OAAOE,UAAW,SAKxBM,aAAaC,SAAUf,UAAYa,cAAcN,aACjDS,YAAYD,SAAUf,UAAYa,cAAcN,OACtDM,cAAcF,iBAAiB,UAAUf,iBACrCK,OAAOC,aAAaU,QAAQ,6BAA8BK,KAAKV,aACzDO,aAAaC,SAAUE,KAAKV,aAC5BS,YAAYD,SAAUF,cAAcN,WAI5CE,aAAeb,MAAAA,WACXsB,UAAYjB,OAAOH,SAASC,cAAc,yBAC1CoB,WAAa,IAAIC,IAAK,GAAEC,OAAOC,wEAAwEC,MACvGC,eAAiBC,MAAMN,YACvBO,mBAAqBF,SAASG,OACpC1B,OAAO2B,QAAQC,IAAIH,cACnBR,UAAUY,YAAc,GACxBZ,UAAUa,mBAAmB,aAAcL,eAGzCZ,aAAelB,MAAMmB,SAAUQ,YAC3BL,UAAYjB,OAAOH,SAASkC,eAAe,kBAE3Cb,WACF,IAAIC,IAAK,GAAEC,OAAOC,sEAAsEC,gBAAgBR,YACtGS,eAAiBC,MAAMN,YACvBO,mBAAqBF,SAASG,OAEpCT,UAAUY,YAAc,GACxBZ,UAAUa,mBAAmB,aAAcL,eAIzCV,YAAcpB,MAAMmB,SAAUQ,YAC1BL,UAAYjB,OAAOH,SAASC,cAAc,kBAE1CoB,WACF,IAAIC,IAAK,GAAEC,OAAOC,iEAAiEC,gBAAgBR,YACjGS,eAAiBC,MAAMN,YACvBO,mBAAqBF,SAASG,OAEpCT,UAAUe,UAAYP"}